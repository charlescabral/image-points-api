"use strict";!function(t){var e=function(t,e,i){return Math.abs(1-Math.abs(t/e))<i},i=function(i,n,o,s,l,a){this.x=i,this.y=n,this.text=o,this.align=l,this.radius=50,void 0!=a&&(this.x=this.x*this.align.x/t(a).width(),this.y=this.y*this.align.y/t(a).height()),this.relativeX=function(e){return this.x*t(e).width()/this.align.x},this.relativeY=function(e){return this.y*t(e).height()/this.align.y},this.render=function(t,e){t.beginPath(),t.arc(this.relativeX(e),this.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(s,this.relativeX(e)-7,this.relativeY(e)+7),t.fill()},this.isMe=function(i,n,o,s){return s=s||.01,void 0!=o&&(i=i*this.align.x/t(o).width(),n=n*this.align.y/t(o).height()),e(i,this.x,s)&&e(n,this.y,s)}};t.fn.dots=function(e,n){var o=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},n),s=document.getElementById("currentMapJson").value,l=JSON.parse(s);o.dots=[],t.each(l,function(e,n){o.dots.push(new i(n.x,n.y,n.text,n.magePos,o.align)),t("#Map_"+n.sku).addClass("existing")}),console.log("input",l),console.log("default array",e),e.filter(function(t,e,i){return l.indexOf(t)===e});var a=t("<div/>").appendTo("body").addClass("hoverDotTooltip").css({backgroundColor:"white",border:"1px solid transparent",position:"absolute",padding:"5px",marginLeft:"-50px"}).hide(),r=[],h=function(e,i,n,s){for(var l=parseInt(e.clientX-n+t(window).scrollLeft()),r=parseInt(e.clientY-s+t(window).scrollTop()),h=!1,c=0;c<o.dots.length;c++){var d=o.dots[c],f=l-d.relativeX(i),u=r-d.relativeY(i);f*f+u*u<d.radius&&(a.get(0).style.top=d.relativeY(i)-40+s+"px",a.get(0).style.left=d.relativeX(i)+n+"px",a.html(d.text),h=!0)}h?(a.show(),a.get(0).style.marginLeft=-a.width()/2+3+"px"):a.hide()},c=function(){t.each(r,function(e,i){t.each(o.dots,function(t,e){e.render(i.ctx,i.el)})})};return this.removeDot=function(t,e){o.dots=o.dots.filter(function(n,o){return i.x!=t&&i.y!=e})},this.each(function(e,n){n.style="background: url("+o.img+");background-repeat: no-repeat; background-size: 100% 100%;width: "+o.width+"; ",o.height;var s=t(n);r.push({el:n,ctx:n.getContext("2d")}),s.mousemove(function(t){h(t,n,n.offsetLeft,n.offsetTop)}),o.setmode&&s.click(function(e){var s,l,a;l=n,a=new i((s=e).clientX-l.offsetLeft,s.clientY-l.offsetTop+t(window).scrollTop(),o.defaulttext,8,o.align,l),console.log("new click",o.dots),o.dots.push(a),c(),o.setcallback(a)}),s.resize(function(t){isNumeric(o.forceRatio)&&s.height(s.width()*o.forceRatio),c()})}),c(),this}}(jQuery);