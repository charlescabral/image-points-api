"use strict";!function(t){var e=[],a=document.getElementById("map_decorated_ambient"),i=""!=t.trim(a.value)?JSON.parse(a.value):[],n=t(".Map_product"),o=[];t.each(n,function(e,a){var i=t(a).find(".Map_title").text(),n=t(a).data("magepos"),s=t(a).data("sku");o.push({text:i,magePos:n,sku:s,maped:!1})});var s=[];i.length>o.length?i.filter(function(t){for(var e=0;e<this.length;e++)if(this[e].sku==t.sku){s.push(t);break}},o):o.filter(function(t,e,a){for(var i=0;i<this.length;i++)if(this[i].sku==t.sku){s.push(this[i]);break}},i);var r=function(t,e,a){return Math.abs(1-Math.abs(t/e))<a},l=function(e,a,i,n,o,s){var l=this;this.x=e,this.y=a,this.text=i,this.align=o,this.radius=50,void 0!=s&&(this.x=this.x*this.align.x/t(s).width(),this.y=this.y*this.align.y/t(s).height()),this.relativeX=function(e){return l.x*t(e).width()/l.align.x},this.relativeY=function(e){return l.y*t(e).height()/l.align.y},this.render=function(t,e){t.beginPath(),t.arc(l.relativeX(e),l.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(n,l.relativeX(e)-7,l.relativeY(e)+7),t.fill()},this.isMe=function(e,a,i,n){return n=n||.01,void 0!=i&&(e=e*l.align.x/t(i).width(),a=a*l.align.y/t(i).height()),r(e,l.x,n)&&r(a,l.y,n)}};t.fn.dots=function(n,r){var u=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},r);u.dots=[],t.each(s,function(e,a){u.dots.push(new l(a.x,a.y,a.text,a.magePos,u.align)),t("#Map_"+a.sku).addClass("maped")}),a.value=JSON.stringify(s);var c=function(){var a,i;a=e,i=u.dots,t.each(a,function(e,a){t.each(i,function(t,e){a.ctx.clearRect(0,0,a.el.width,a.el.height)})}),t.each(e,function(e,a){t.each(u.dots,function(t,e){e.render(a.ctx,a.el)})})};return this.removeDot=function(t,e){u.dots=u.dots.filter(function(a,i){return l.x!=t&&l.y!=e})},this.each(function(n,r){r.style="background: url("+u.img+");background-repeat: no-repeat;background-size: 100% 100%;width: "+u.width+";height: "+u.height+";";var h=t(r);e.push({el:r,ctx:r.getContext("2d")}),h.mousemove(function(t){}),u.setmode&&h.click(function(e){var n;n=0,o.filter(function(t,e){for(var a=0;a<this.length;a++)if(this[a].sku==t.sku){o[e].maped=!0;break}!t.maped&&n++},i),n&&(t("#Map_options").html(""),t.each(o,function(t,e){if(!e.maped){var a=document.createElement("input");a.setAttribute("type","radio"),a.setAttribute("name","map-options"),a.setAttribute("value",e.magePos),a.setAttribute("data-sku",e.sku),a.setAttribute("data-text",e.text),a.className="Map_modal-option";var i=document.createElement("label");i.appendChild(a),i.appendChild(document.createTextNode(e.text)),document.getElementById("Map_options").appendChild(i)}}),t(".Map_modal").fadeIn(500,function(){var n,o;n=e,o=r,t(".Map_modal-option").change(function(){var e=t(this),r=e.val(),h=e.data("sku"),d=e.data("text");t("#Map_"+h).addClass("maped");var f=t(o).parent().offset(),p=new l(n.clientX-f.left,n.clientY-f.top+t(window).scrollTop(),d,r,u.align,o);p.text=d,u.dots.push(p),c(),u.setcallback(p),t(".Map_modal").fadeOut(300,function(){t.each([s,i],function(t,e){e.push({x:p.x,y:p.y,text:d,magePos:r,sku:h,maped:!0})}),a.value=JSON.stringify(s)})})}))}),h.resize(function(t){isNumeric(u.forceRatio)&&h.height(h.width()*u.forceRatio),c()})}),t(".clear_porratoda").click(function(){console.log("apaga a porra toda",u.dots)}),c(),this}}(jQuery);