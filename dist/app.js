"use strict";!function(t){var e=[],i=document.getElementById("map_decorated_ambient"),a=""!=t.trim(i.value)?JSON.parse(i.value):[],n=t(".Map_product"),o=[];t.each(n,function(e,i){var a=t(i).find(".Map_title").text(),n=t(i).data("magepos"),s=t(i).data("sku");o.push({text:a,magePos:n,sku:s,maped:!1})});var s=[];a.length>o.length?a.filter(function(t){for(var e=0;e<this.length;e++)if(this[e].sku==t.sku){s.push(t);break}},o):o.filter(function(t,e,i){for(var a=0;a<this.length;a++)if(this[a].sku==t.sku){s.push(this[a]);break}},a);var l=function(t,e,i){return Math.abs(1-Math.abs(t/e))<i},r=function(t,e){i.value=[]},u=function(e,i,a,n,o,s){var r=this;this.x=e,this.y=i,this.text=a,this.align=o,this.radius=50,void 0!=s&&(this.x=this.x*this.align.x/t(s).width(),this.y=this.y*this.align.y/t(s).height()),this.relativeX=function(e){return r.x*t(e).width()/r.align.x},this.relativeY=function(e){return r.y*t(e).height()/r.align.y},this.render=function(t,e){t.beginPath(),t.arc(r.relativeX(e),r.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(n,r.relativeX(e),r.relativeY(e)),t.textAlign="center",t.fill()},this.isMe=function(e,i,a,n){return n=n||.01,void 0!=a&&(e=e*r.align.x/t(a).width(),i=i*r.align.y/t(a).height()),l(e,r.x,n)&&l(i,r.y,n)}};t.fn.dots=function(n,l){var h=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},l);h.dots=[],s.filter(function(e,i){for(var a=0;a<this.length;a++)if(this[a].sku==e.sku){e.magePos=this[a].magePos;break}h.dots.push(new u(e.x,e.y,e.text,e.magePos,h.align)),t("#Map_"+e.sku).addClass("maped")},o),i.value=JSON.stringify(s);var c=function(){var i,a;i=e,a=h.dots,t.each(i,function(e,i){t.each(a,function(t,e){i.ctx.clearRect(0,0,i.el.width,i.el.height)})}),t.each(e,function(e,i){t.each(h.dots,function(t,e){console.log(e),e.render(i.ctx,i.el)})})};return this.removeDot=function(t,e){h.dots=h.dots.filter(function(i,a){return u.x!=t&&u.y!=e})},this.each(function(n,l){l.style="background: url("+h.img+");background-repeat: no-repeat;background-size: 100% 100%;width: "+h.width+";height: "+h.height+";";var r=t(l);e.push({el:l,ctx:l.getContext("2d")}),r.mousemove(function(t){}),h.setmode&&r.click(function(e){var n,r;n=o,r=0,console.log("html click ",n),n.filter(function(t,e){for(var i=0;i<this.length;i++)if(this[i].sku==t.sku){n[e].maped=!0;break}!t.maped&&r++},a),r&&(!function(e){t("#Map_options").html(""),t.each(e,function(t,e){if(!e.maped){var i=document.createElement("input");i.setAttribute("type","radio"),i.setAttribute("name","map-options"),i.setAttribute("value",e.magePos),i.setAttribute("data-sku",e.sku),i.setAttribute("data-text",e.text),i.className="Map_modal-option";var a=document.createElement("label");a.appendChild(i),a.appendChild(document.createTextNode(e.text)),document.getElementById("Map_options").appendChild(a)}})}(o),t(".Map_modal").fadeIn(500,function(){var n,o;n=e,o=l,t(".Map_modal-option").change(function(){var e=t(this),l=e.val(),r=e.data("sku"),d=e.data("text");t("#Map_"+r).addClass("maped");var f=t(o).parent().offset(),p=new u(n.clientX-f.left,n.clientY-f.top+t(window).scrollTop(),d,l,h.align,o);p.text=d,h.dots.push(p),c(),h.setcallback(p),t(".Map_modal").fadeOut(300,function(){t.each([s,a],function(t,e){e.push({x:p.x,y:p.y,text:d,magePos:l,sku:r,maped:!0})}),i.value=JSON.stringify(s)})})}))}),r.resize(function(t){isNumeric(h.forceRatio)&&r.height(r.width()*h.forceRatio),c()})}),t(".saveClearDots").click(r),c(),this}}(jQuery);