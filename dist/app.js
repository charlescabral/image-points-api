"use strict";!function(t){var e=[],i=document.getElementById("map_decorated_ambient"),a=""!=t.trim(i.value)?JSON.parse(i.value):[],n=t(".Map_product"),s=[];t.each(n,function(e,i){var a=t(i).find(".Map_title").text(),n=t(i).data("magepos"),o=t(i).data("sku");s.push({text:a,magePos:n,sku:o,maped:!1})});var o=[];a.length>s.length?a.filter(function(t){for(var e=0;e<this.length;e++)if(this[e].sku==t.sku){o.push(t);break}},s):s.filter(function(t,e,i){for(var a=0;a<this.length;a++)if(this[a].sku==t.sku){o.push(this[a]);break}},a);var l=function(t,e,i){return Math.abs(1-Math.abs(t/e))<i},r=function(e,i,a,n,s,o){this.x=e,this.y=i,this.text=a,this.align=s,this.radius=50,void 0!=o&&(this.x=this.x*this.align.x/t(o).width(),this.y=this.y*this.align.y/t(o).height()),this.relativeX=function(e){return this.x*t(e).width()/this.align.x},this.relativeY=function(e){return this.y*t(e).height()/this.align.y},this.render=function(t,e){t.beginPath(),t.arc(this.relativeX(e),this.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(n,this.relativeX(e)-7,this.relativeY(e)+7),t.fill()},this.isMe=function(e,i,a,n){return n=n||.01,void 0!=a&&(e=e*this.align.x/t(a).width(),i=i*this.align.y/t(a).height()),l(e,this.x,n)&&l(i,this.y,n)}};t.fn.dots=function(n,l){var u=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},l);u.dots=[],t.each(o,function(e,i){u.dots.push(new r(i.x,i.y,i.text,i.magePos,u.align)),t("#Map_"+i.sku).addClass("maped")}),i.value=JSON.stringify(o);var h=function(){t.each(e,function(e,i){t.each(u.dots,function(t,e){e.render(i.ctx,i.el)})})};return this.removeDot=function(t,e){u.dots=u.dots.filter(function(i,a){return r.x!=t&&r.y!=e})},this.each(function(n,l){l.style="background: url("+u.img+");background-repeat: no-repeat; background-size: 100% 100%;width: "+u.width+"; ",u.height;var c=t(l);e.push({el:l,ctx:l.getContext("2d")}),c.mousemove(function(t){}),u.setmode&&c.click(function(e){var n;console.log(c),n=0,s.filter(function(t,e){for(var i=0;i<a.length;i++)if(a[i].sku==t.sku){s[e].maped=!0;break}!t.maped&&n++}),n&&(t("#Map_options").html(""),t.each(s,function(t,e){if(!e.maped){var i=document.createElement("input");i.setAttribute("type","radio"),i.setAttribute("name","map-options"),i.setAttribute("value",e.magePos),i.setAttribute("data-sku",e.sku),i.setAttribute("data-text",e.text),i.className="Map_modal-option";var a=document.createElement("label");a.appendChild(i),a.appendChild(document.createTextNode(e.text)),document.getElementById("Map_options").appendChild(a)}}),t(".Map_modal").fadeIn(500,function(){var n,s;n=e,s=l,t(".Map_modal-option").change(function(){var e=t(this),l=e.val(),c=e.data("sku"),d=e.data("text");t("#Map_"+c).addClass("maped");var f=t(s).parent().offset(),p=new r(n.clientX-f.left,n.clientY-f.top+t(window).scrollTop(),d,l,u.align,s);p.text=d,u.dots.push(p),h(),u.setcallback(p),t(".Map_modal").fadeOut(300,function(){t.each([o,a],function(t,e){e.push({x:p.x,y:p.y,text:d,magePos:l,sku:c,maped:!0})}),i.value=JSON.stringify(o)})})}))}),c.resize(function(t){isNumeric(u.forceRatio)&&c.height(c.width()*u.forceRatio),h()})}),t(".clear_porratoda").click(function(){console.log("apaga a porra toda",u.dots)}),h(),this}}(jQuery);