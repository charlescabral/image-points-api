"use strict";!function(t){var e=function(t,e,i){return Math.abs(1-Math.abs(t/e))<i},i=function(i,n,a,o,s,l){this.x=i,this.y=n,this.text=a,this.align=s,this.radius=50,void 0!=l&&(this.x=this.x*this.align.x/t(l).width(),this.y=this.y*this.align.y/t(l).height()),this.relativeX=function(e){return this.x*t(e).width()/this.align.x},this.relativeY=function(e){return this.y*t(e).height()/this.align.y},this.render=function(t,e){t.beginPath(),t.arc(this.relativeX(e),this.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(o,this.relativeX(e)-7,this.relativeY(e)+7),t.fill()},this.isMe=function(i,n,a,o){return o=o||.01,void 0!=a&&(i=i*this.align.x/t(a).width(),n=n*this.align.y/t(a).height()),e(i,this.x,o)&&e(n,this.y,o)}};t.fn.dots=function(e,n){var a=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},n),o=document.getElementById("currentMapJson").value,s=JSON.parse(o),l=t(".Map_product"),r=[];t.each(l,function(e,i){var n=t(i).find(".Map_title").text(),a=t(i).data("magepos"),o=t(i).data("sku");r.push({text:n,magePos:a,sku:o,existing:!1})}),r.filter(function(t,e){for(var i=0;i<s.length;i++)if(s[i].sku==t.sku){r[e].existing=!0;break}}),a.dots=[],t.each(s,function(e,n){a.dots.push(new i(n.x,n.y,n.text,n.magePos,a.align)),t("#Map_"+n.sku).addClass("existing").removeClass("setPosition")});var h=t("<div/>").appendTo("body").addClass("hoverDotTooltip").css({backgroundColor:"white",border:"1px solid transparent",position:"absolute",padding:"5px",marginLeft:"-50px"}).hide(),d=[],c=function(e,i,n,o){for(var s=parseInt(e.clientX-n+t(window).scrollLeft()),l=parseInt(e.clientY-o+t(window).scrollTop()),r=!1,d=0;d<a.dots.length;d++){var c=a.dots[d],u=s-c.relativeX(i),f=l-c.relativeY(i);u*u+f*f<c.radius&&(h.get(0).style.top=c.relativeY(i)-40+o+"px",h.get(0).style.left=c.relativeX(i)+n+"px",h.html(c.text),r=!0)}r?(h.show(),h.get(0).style.marginLeft=-h.width()/2+3+"px"):h.hide()},u=function(){t.each(d,function(e,i){t.each(a.dots,function(t,e){e.render(i.ctx,i.el)})})};return this.removeDot=function(t,e){a.dots=a.dots.filter(function(n,a){return i.x!=t&&i.y!=e})},this.each(function(e,n){n.style="background: url("+a.img+");background-repeat: no-repeat; background-size: 100% 100%;width: "+a.width+"; ",a.height;var o=t(n);d.push({el:n,ctx:n.getContext("2d")}),o.mousemove(function(t){c(t,n,n.offsetLeft,n.offsetTop)}),a.setmode&&o.click(function(e){var o,s;o=e,s=n,t.each(r,function(t,e){if(!e.existing){var i=document.createElement("a");i.textContent=e.text,i.className="Map_modal-link",i.setAttribute("data-magePos",e.magePos),i.href="#SKU_"+e.sku,document.getElementById("Map_options").appendChild(i)}}),t(".Map_modal").fadeIn(500,function(){t(document).bind("click",".Map_modal-link",function(e){var n=new i(o.clientX-s.offsetLeft,o.clientY-s.offsetTop+t(window).scrollTop(),t(e)[0].target.innerText,t(e)[0].target.dataset.magepos,a.align,s);t(".Map_modal").fadeOut(300,function(e){a.dots.push(n),u(),a.setcallback(n),t("#Map_options").html("")})})})}),o.resize(function(t){isNumeric(a.forceRatio)&&o.height(o.width()*a.forceRatio),u()})}),u(),this}}(jQuery);