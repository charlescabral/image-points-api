"use strict";!function(t){var e=document.getElementById("map_decorated_ambient"),i=""!=t.trim(e.value)?JSON.parse(e.value):[],a=t(".Map_product"),n=[];t.each(a,function(e,i){var a=t(i).find(".Map_title").text(),o=t(i).data("magepos"),s=t(i).data("sku");n.push({text:a,magePos:o,sku:s,maped:!1})});var o=function(t,e,i){return Math.abs(1-Math.abs(t/e))<i},s=function(e,i,a,n,s,l){this.x=e,this.y=i,this.text=a,this.align=s,this.radius=50,void 0!=l&&(this.x=this.x*this.align.x/t(l).width(),this.y=this.y*this.align.y/t(l).height()),this.relativeX=function(e){return this.x*t(e).width()/this.align.x},this.relativeY=function(e){return this.y*t(e).height()/this.align.y},this.render=function(t,e){t.beginPath(),t.arc(this.relativeX(e),this.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(n,this.relativeX(e)-7,this.relativeY(e)+7),t.fill()},this.isMe=function(e,i,a,n){return n=n||.01,void 0!=a&&(e=e*this.align.x/t(a).width(),i=i*this.align.y/t(a).height()),o(e,this.x,n)&&o(i,this.y,n)}};t.fn.dots=function(a,o){var l=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},o);l.dots=[],t.each(i,function(e,i){l.dots.push(new s(i.x,i.y,i.text,i.magePos,l.align)),t("#Map_"+i.sku).addClass("maped")});var r=[],u=function(){t.each(r,function(e,i){t.each(l.dots,function(t,e){e.render(i.ctx,i.el)})})};return this.removeDot=function(t,e){l.dots=l.dots.filter(function(i,a){return s.x!=t&&s.y!=e})},this.each(function(a,o){o.style="background: url("+l.img+");background-repeat: no-repeat; background-size: 100% 100%;width: "+l.width+"; ",l.height;var d=t(o);r.push({el:o,ctx:o.getContext("2d")}),d.mousemove(function(t){}),l.setmode&&d.click(function(a){(function(){var t=0;return n.filter(function(e,a){for(var o=0;o<i.length;o++)if(i[o].sku==e.sku){n[a].maped=!0;break}e.maped||t++}),!!t})()&&(t.each(n,function(t,e){if(!e.maped){var i=document.createElement("input");i.setAttribute("type","radio"),i.setAttribute("name","map-options"),i.setAttribute("value",e.magePos),i.setAttribute("data-sku",e.sku),i.setAttribute("data-text",e.text),i.className="Map_modal-option";var a=document.createElement("label");a.appendChild(i),a.appendChild(document.createTextNode(e.text)),document.getElementById("Map_options").appendChild(a)}}),t(".Map_modal").fadeIn(500,function(){var n,r;n=a,r=o,t(".Map_modal-option").change(function(){var a=t(this),o=a.val(),d=a.data("sku"),h=a.data("text");t("#Map_"+d).addClass("maped");var c=t(r).parent().offset(),f=new s(n.clientX-c.left,n.clientY-c.top+t(window).scrollTop(),h,o,l.align,r);f.text=h,console.log(f.text),l.dots.push(f),u(),l.setcallback(f),t(".Map_modal").fadeOut(300,function(){t("#Map_options").html(""),i.push({x:f.x,y:f.y,text:h,magePos:o,sku:d,maped:!0}),e.value=JSON.stringify(i)})})}))}),d.resize(function(t){isNumeric(l.forceRatio)&&d.height(d.width()*l.forceRatio),u()})}),u(),this}}(jQuery);