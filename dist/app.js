"use strict";!function(t){var e=function(t,e,i){return Math.abs(1-Math.abs(t/e))<i},i=function(i,n,s,o,a,l){this.x=i,this.y=n,this.text=s,this.align=a,this.radius=50,void 0!=l&&(this.x=this.x*this.align.x/t(l).width(),this.y=this.y*this.align.y/t(l).height()),this.relativeX=function(e){return this.x*t(e).width()/this.align.x},this.relativeY=function(e){return this.y*t(e).height()/this.align.y},this.render=function(t,e){t.beginPath(),t.arc(this.relativeX(e),this.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(o,this.relativeX(e)-7,this.relativeY(e)+7),t.fill()},this.isMe=function(i,n,s,o){return o=o||.01,void 0!=s&&(i=i*this.align.x/t(s).width(),n=n*this.align.y/t(s).height()),e(i,this.x,o)&&e(n,this.y,o)}};t.fn.dots=function(e,n){var s=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},n),o=document.getElementById("currentMapJson").value,a=JSON.parse(o),l=t(".Map_product"),r=[];t.each(l,function(e,i){var n=t(i).find(".Map_title").text(),s=t(i).data("magepos"),o=t(i).data("sku");r.push({text:n,magePos:s,sku:o,existing:!1})}),r.filter(function(t,e){for(var i=0;i<a.length;i++)if(a[i].sku==t.sku){r[e].existing=!0;break}}),console.log(r),s.dots=[],t.each(a,function(e,n){s.dots.push(new i(n.x,n.y,n.text,n.magePos,s.align)),t("#Map_"+n.sku).addClass("existing").removeClass("setPosition")});var h=t("<div/>").appendTo("body").addClass("hoverDotTooltip").css({backgroundColor:"white",border:"1px solid transparent",position:"absolute",padding:"5px",marginLeft:"-50px"}).hide(),c=[],d=function(e,i,n,o){for(var a=parseInt(e.clientX-n+t(window).scrollLeft()),l=parseInt(e.clientY-o+t(window).scrollTop()),r=!1,c=0;c<s.dots.length;c++){var d=s.dots[c],f=a-d.relativeX(i),u=l-d.relativeY(i);f*f+u*u<d.radius&&(h.get(0).style.top=d.relativeY(i)-40+o+"px",h.get(0).style.left=d.relativeX(i)+n+"px",h.html(d.text),r=!0)}r?(h.show(),h.get(0).style.marginLeft=-h.width()/2+3+"px"):h.hide()},f=function(){t.each(c,function(e,i){t.each(s.dots,function(t,e){e.render(i.ctx,i.el)})})};return this.removeDot=function(t,e){s.dots=s.dots.filter(function(n,s){return i.x!=t&&i.y!=e})},this.each(function(e,n){n.style="background: url("+s.img+");background-repeat: no-repeat; background-size: 100% 100%;width: "+s.width+"; ",s.height;var o=t(n);c.push({el:n,ctx:n.getContext("2d")}),o.mousemove(function(t){d(t,n,n.offsetLeft,n.offsetTop)}),s.setmode&&o.click(function(e){var o,a,l;a=n,l=new i((o=e).clientX-a.offsetLeft,o.clientY-a.offsetTop+t(window).scrollTop(),s.defaulttext,8,s.align,a),s.dots.push(l),f(),s.setcallback(l)}),o.resize(function(t){isNumeric(s.forceRatio)&&o.height(o.width()*s.forceRatio),f()})}),f(),this}}(jQuery);