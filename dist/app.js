"use strict";!function(t){var e=[],a=function(t,e){for(var a in e)t.setAttribute(a,e[a])},i=document.getElementById("map_decorated_ambient"),n=""!=t.trim(i.value)?JSON.parse(i.value):[],o=t(".Map_product"),s=[];t.each(o,function(e,a){var i=t(a).find(".Map_title").text(),n=t(a).data("magepos"),o=t(a).data("sku");s.push({text:i,magePos:n,sku:o,maped:!1})});var l=[];n.length>s.length?n.filter(function(t){for(var e=0;e<this.length;e++)if(this[e].sku==t.sku){l.push(t);break}},s):s.filter(function(t,e,a){for(var i=0;i<this.length;i++)if(this[i].sku==t.sku){l.push(this[i]);break}},n);var u=function(t,e,a){return Math.abs(1-Math.abs(t/e))<a},r=function(){i.value=[],t('button[title="Salvar e continuar a editar"]').trigger("click")},c=function(e,a,i,n,o,s){var l=this;this.x=e,this.y=a,this.text=i,this.align=o,this.radius=50,void 0!=s&&(this.x=this.x*this.align.x/t(s).width(),this.y=this.y*this.align.y/t(s).height()),this.relativeX=function(e){return l.x*t(e).width()/l.align.x},this.relativeY=function(e){return l.y*t(e).height()/l.align.y},this.render=function(t,e){t.beginPath(),t.arc(l.relativeX(e),l.relativeY(e),32,0,2*Math.PI,!0),t.fillStyle="#0b255a",t.fill(),t.beginPath(),t.textBaseline="middle",t.textAlign="center",t.fillStyle="#FFF",t.font="bold 24px Arial",t.fillText(n,l.relativeX(e),l.relativeY(e)),t.fill()},this.isMe=function(e,a,i,n){return n=n||.01,void 0!=i&&(e=e*l.align.x/t(i).width(),a=a*l.align.y/t(i).height()),u(e,l.x,n)&&u(a,l.y,n)}};t.fn.dots=function(o,u){var d=t.extend({img:"",setmode:!1,setcallback:function(t){},defaulttext:"New Item",forceRatio:!1,align:{x:100,y:100}},u);d.dots=[],l.filter(function(e,a){for(var i=0;i<this.length;i++)if(this[i].sku==e.sku){e.magePos=this[i].magePos;break}d.dots.push(new c(e.x,e.y,e.text,e.magePos,d.align)),t("#Map_"+e.sku).addClass("maped")},s),i.value=JSON.stringify(l);var h=function(){var a,i;a=e,i=d.dots,t.each(a,function(e,a){t.each(i,function(t,e){a.ctx.clearRect(0,0,a.el.width,a.el.height)})}),t.each(e,function(e,a){t.each(d.dots,function(t,e){e.render(a.ctx,a.el)})})},f=function(e,a){t(".Map_modal-option").change(function(){var o,s=t(this),u=s.val(),r=s.data("sku"),f=s.data("text");if(/^(\-|\+)?([0-9]+|Infinity)$/.test(o=u)||Number(o)){var p=t(a).parent().offset(),m=new c(e.clientX-p.left,e.clientY-p.top+t(window).scrollTop(),f,u,d.align,a);m.text=f,t("#Map_"+r).addClass("maped"),d.dots.push(m),h(),d.setcallback(m),t(".Map_modal").fadeOut(300,function(){t.each([l,n],function(t,e){e.push({x:m.x,y:m.y,text:f,magePos:u,sku:r,maped:!0})}),i.value=JSON.stringify(l)})}else t(".Map_modal").fadeOut(300)})};return this.removeDot=function(t,e){d.dots=d.dots.filter(function(a,i){return c.x!=t&&c.y!=e})},this.each(function(i,o){o.style="background: url("+d.img+");background-repeat: no-repeat;background-size: 100% 100%;width: "+d.width+";height: "+d.height+";";var l=t(o);e.push({el:o,ctx:o.getContext("2d")}),l.mousemove(function(t){}),d.setmode&&l.click(function(e){var i,l;l=0,(i=s).filter(function(t,e){for(var a=0;a<this.length;a++)if(this[a].sku==t.sku){i[e].maped=!0;break}!t.maped&&l++},n),l&&(!function(e){t("#Map_options").html(""),t.each(e,function(t,e){if(!e.maped){var i=document.createElement("input");a(i,{type:"radio",name:"map-options",value:e.magePos,"data-sku":e.sku,"data-text":e.text,class:"Map_modal-option"});var n=document.createElement("label");n.appendChild(i),n.appendChild(document.createTextNode(e.text)),document.getElementById("Map_options").appendChild(n)}})}(s),function(){var e="Map_cancel-label";t("#"+e).html("");var i=document.createElement("input");a(i,{type:"radio",name:"map-options",value:"cancel",class:"Map_modal-option"}),document.getElementById(e).appendChild(i)}(),t(".Map_modal").fadeIn(500,function(){f(e,o)}))}),l.resize(function(t){isNumeric(d.forceRatio)&&l.height(l.width()*d.forceRatio),h()})}),t(document).on("click",".saveClearDots",r),t(document).on("click",".Map_delete",function(){t(this).data("sku");d.dots}),h(),this}}(jQuery);